generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["debian-openssl-1.1.x", "darwin", "darwin-arm64", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Admin {
  hash            String
  login           String           @id @unique
  acceptedStampes StampedProduct[] @relation("AcceptStampedProduct")
  changedStampes  StampAudit[]     @relation("ChangeStampedProduct")
}

model Tread {
  code           String           @id @unique
  name           String
  stampedProduct StampedProduct[]
}

model Stampist {
  id       Int              @id @unique
  name     String
  products StampedProduct[]
}

model StampedProduct {
  id         Int          @id @unique @default(autoincrement())
  stampistID Int
  treadCode  String
  amount     Int
  createdAt  DateTime
  createdBy  String
  isDeleted  Boolean      @default(false)
  accepter   Admin        @relation("AcceptStampedProduct", fields: [createdBy], references: [login])
  tread      Tread        @relation(fields: [treadCode], references: [code])
  stampist   Stampist     @relation(fields: [stampistID], references: [id])
  changes    StampAudit[]
}

model StampAudit {
  id             Int            @id @unique @default(autoincrement())
  productID      Int
  stampistID     Int
  treadCode      String
  action         String
  amount         Int
  changedBy      String
  changedAt      DateTime       @default(now())
  changer        Admin          @relation("ChangeStampedProduct", fields: [changedBy], references: [login])
  stampedProduct StampedProduct @relation(fields: [productID], references: [id])
}
